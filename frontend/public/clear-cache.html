<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clear Cache & Storage</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .card {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-top: 0;
        }
        button {
            background: #4f46e5;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #4338ca;
        }
        .info {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }
        .success {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            color: #166534;
        }
        .warning {
            background: #fef3c7;
            border: 1px solid #fde68a;
            color: #92400e;
        }
        pre {
            background: #1e293b;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="card">
        <h1>ğŸ”§ TEFAS Dashboard - Cache & Storage Cleaner</h1>

        <div class="info">
            <p><strong>Bu sayfa ÅŸunlarÄ± yapar:</strong></p>
            <ul>
                <li>LocalStorage'daki eski Supabase verilerini temizler</li>
                <li>SessionStorage'Ä± temizler</li>
                <li>IndexedDB'yi temizler</li>
                <li>Sayfa cache'ini temizler</li>
            </ul>
        </div>

        <div id="status"></div>

        <button onclick="clearAllStorage()">ğŸ—‘ï¸ TÃ¼m Cache ve Storage'Ä± Temizle</button>
        <button onclick="showCurrentStorage()">ğŸ‘€ Mevcut Storage'Ä± GÃ¶ster</button>
        <button onclick="window.location.href='/'">ğŸ  Ana Sayfaya DÃ¶n</button>

        <div id="output"></div>
    </div>

    <script>
        function clearAllStorage() {
            const status = document.getElementById('status');
            const output = document.getElementById('output');

            try {
                // Clear app-specific keys from localStorage and sessionStorage
                const isAppKey = key => key.includes('foncu') || key.includes('supabase') || key.includes('sb-');

                Object.keys(localStorage).filter(isAppKey).forEach(key => {
                    console.log('Deleting from localStorage:', key);
                    localStorage.removeItem(key);
                });

                Object.keys(sessionStorage).filter(isAppKey).forEach(key => {
                    console.log('Deleting from sessionStorage:', key);
                    sessionStorage.removeItem(key);
                });

                status.innerHTML = '<div class="info success">âœ… TÃ¼m cache ve storage baÅŸarÄ±yla temizlendi! Åimdi sayfayÄ± yenileyin (Cmd+Shift+R veya Ctrl+Shift+R).</div>';

                setTimeout(() => {
                    status.innerHTML += '<div class="info warning">âš ï¸ 3 saniye iÃ§inde sayfa otomatik olarak yenilenecek...</div>';
                    setTimeout(() => {
                        window.location.href = '/?t=' + Date.now();
                    }, 3000);
                }, 1000);

            } catch (error) {
                status.innerHTML = '<div class="info" style="background: #fee2e2; border-color: #fecaca; color: #991b1b;">âŒ Hata: ' + error.message + '</div>';
            }
        }

        function showCurrentStorage() {
            const output = document.getElementById('output');

            const data = {
                localStorage: {},
                sessionStorage: {},
                cookies: document.cookie
            };

            // Get localStorage
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                data.localStorage[key] = localStorage.getItem(key);
            }

            // Get sessionStorage
            for (let i = 0; i < sessionStorage.length; i++) {
                const key = sessionStorage.key(i);
                data.sessionStorage[key] = sessionStorage.getItem(key);
            }

            output.innerHTML = '<h3>Current Storage Contents:</h3><pre>' + JSON.stringify(data, null, 2) + '</pre>';
        }

        // Auto-detect old Supabase URL
        window.addEventListener('load', () => {
            const status = document.getElementById('status');
            let hasOldUrl = false;

            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const value = localStorage.getItem(key);
                if (value && value.includes('kyvfnaytfvgkfnccteya')) {
                    hasOldUrl = true;
                    break;
                }
            }

            if (hasOldUrl) {
                status.innerHTML = '<div class="info warning">âš ï¸ ESKÄ° SUPABASE URL TESPÄ°T EDÄ°LDÄ°! LÃ¼tfen "TÃ¼m Cache ve Storage\'Ä± Temizle" butonuna tÄ±klayÄ±n.</div>';
            } else {
                status.innerHTML = '<div class="info success">âœ… Eski Supabase URL\'si bulunamadÄ±. Storage temiz gÃ¶rÃ¼nÃ¼yor.</div>';
            }
        });
    </script>
</body>
</html>
